{% extends 'base.html.twig' %}

{% block head %}
    <!-- AOS (Animate on Scroll) Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Blog Theme CSS -->
    <link rel="stylesheet" href="{{ assets_url }}/css/blog-theme.css">
    
    <style>
        .article-hero {
            position: relative;
            min-height: 60vh;
            display: flex;
            align-items: center;
            color: white;
            text-align: center;
            overflow: hidden;
        }
        
        .article-hero-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
        }
        
        .article-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6));
            z-index: -1;
        }
        
        .article-header {
            position: relative;
            z-index: 1;
        }
        
        .author-info img {
            width: 50px;
            height: 50px;
            object-fit: cover;
        }
        
        .article-body {
            font-size: 1.125rem;
            line-height: 1.75;
            color: var(--bs-body-color);
        }
        
        .article-body h2 {
            color: var(--primary-color);
            margin: 2.5rem 0 1.5rem;
            font-weight: 600;
        }
        
        .article-body h3 {
            margin: 2rem 0 1rem;
            font-weight: 600;
        }
        
        .article-body p {
            margin-bottom: 1.5rem;
        }
        
        .article-body blockquote {
            background: var(--bs-tertiary-bg);
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
            font-style: italic;
            position: relative;
        }
        
        .article-body blockquote::before {
            content: '"';
            font-size: 4rem;
            color: var(--primary-color);
            position: absolute;
            top: -10px;
            left: 20px;
            font-family: Georgia, serif;
        }
        
        .author-box {
            background: var(--bs-tertiary-bg);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin: 3rem 0;
            border: 1px solid var(--bs-border-color);
        }
        
        .author-box img {
            width: 80px;
            height: 80px;
            object-fit: cover;
        }
        
        .share-box {
            background: var(--bs-body-bg);
            border: 1px solid var(--bs-border-color);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .share-icons a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-decoration: none;
            font-size: 1.25rem;
            transition: all var(--transition-speed) ease;
        }
        
        .share-icons a:hover {
            background: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .related-articles .article-card {
            border: none;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all var(--transition-speed) ease;
            height: 100%;
        }
        
        .related-articles .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
        }
        
        .related-articles .card-img-top {
            height: 200px;
            object-fit: cover;
        }
        
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            z-index: 9999;
            transition: width 0.3s ease;
        }
        
        .table-of-contents {
            background: var(--bs-tertiary-bg);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid var(--bs-border-color);
        }
        
        .table-of-contents ul {
            list-style: none;
            padding-left: 0;
        }
        
        .table-of-contents li {
            margin-bottom: 0.5rem;
        }
        
        .table-of-contents a {
            color: var(--bs-body-color);
            text-decoration: none;
            transition: color var(--transition-speed) ease;
        }
        
        .table-of-contents a:hover {
            color: var(--primary-color);
        }
    </style>
{% endblock %}

{% block main %}
<main>
    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="reading-progress"></div>

    <!-- Article Header -->
    <header class="article-hero">
        <img src="{{ article.featured_image|default('https://images.unsplash.com/photo-1550745165-9bc0b252726a?q=80&w=1470&auto=format&fit=crop') }}" 
             class="article-hero-bg" 
             alt="{{ article.title }}">
        <div class="container article-header">
            {% if article.category %}
                <a href="{{ article.category.link }}" class="badge bg-primary text-decoration-none mb-3 fs-6">
                    {{ article.category.name }}
                </a>
            {% endif %}
            <h1 class="display-4 col-lg-9 mx-auto">{{ article.title|default('The Resurgence of Retro Gaming in a High-Def World') }}</h1>
            <p class="lead col-lg-7 mx-auto">{{ article.excerpt|default('Exploring why pixel art and 8-bit soundtracks are capturing the hearts of a new generation.') }}</p>
            <div class="d-flex align-items-center justify-content-center author-info mt-4">
                <img src="{{ article.author.avatar|default('https://images.unsplash.com/photo-1557862921-37829c790f19?q=80&w=2071&auto=format&fit=crop') }}" 
                     class="rounded-circle me-2" 
                     alt="{{ article.author.name }}">
                <div class="text-start">
                    <div class="fw-bold">{{ article.author.name|default('Alex Doe') }}</div>
                    <small>Published on {{ article.published_at|date('M d, Y')|default('Jul 30, 2025') }} • {{ article.reading_time|default('7') }} min read</small>
                </div>
            </div>
        </div>
    </header>

    <div class="container-xl mt-5 pt-4">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Table of Contents (if available) -->
                {% if article.toc %}
                <nav class="table-of-contents" data-aos="fade-up">
                    <h4 class="mb-3"><i class="bi bi-list-ol me-2"></i>Table of Contents</h4>
                    <ul>
                        {% for item in article.toc %}
                            <li><a href="#{{ item.anchor }}">{{ item.title }}</a></li>
                        {% endfor %}
                    </ul>
                </nav>
                {% endif %}

                <!-- Article Content -->
                <article class="article-body" data-aos="fade-up">
                    {{ article.content|default('<p class="lead">In an era dominated by photorealistic graphics and sprawling open worlds, a curious trend has taken hold of the gaming industry: the vibrant, unapologetic resurgence of retro gaming. It\'s more than just nostalgia; it\'s a testament to the timeless appeal of focused gameplay, imaginative art styles, and the sheer joy of simple, well-crafted mechanics.</p>
                    <p>From indie darlings like \'Stardew Valley\' to critically acclaimed titles such as \'Celeste\', pixel art and chiptune music are not just surviving—they are thriving. But why? What is it about these seemingly simple aesthetics that resonates so deeply with both veteran gamers and a new generation raised on 4K displays?</p>
                    <h2 id="power-of-constraints">The Power of Constraints</h2>
                    <p>One of the core reasons for the retro revival lies in the power of creative constraints. Early game developers in the 8-bit and 16-bit eras didn\'t have unlimited polygons or high-resolution textures. They had a limited palette of colors and a handful of pixels to create entire worlds. This forced a level of creativity and abstraction that modern games rarely need to explore.</p>
                    <blockquote>"Creativity is the art of concealing your sources. In retro gaming, the source was a severe lack of resources, and the art was magnificent."</blockquote>
                    <p>This limitation meant that gameplay had to be king. Without stunning visuals to lean on, the core loop of a game—the running, jumping, shooting, or puzzle-solving—had to be exceptionally tight and satisfying. This focus on mechanics is a major draw for players seeking a challenge that tests their skills rather than their patience with cinematic cutscenes.</p>
                    <img src="https://images.unsplash.com/photo-1612036782180-6f0b6cd84627?q=80&w=1470&auto=format&fit=crop" class="img-fluid rounded-4 shadow my-4" alt="Close up of a retro controller" data-aos="zoom-in">
                    <h2 id="new-wave-artistry">A New Wave of Artistry</h2>
                    <p>Modern retro-style games are not simply mimicking the past; they are reinterpreting it. Today\'s developers use pixel art not as a limitation, but as a deliberate stylistic choice. They have access to modern tools and an unlimited color palette, allowing them to create breathtakingly detailed and expressive pixel art that would have been impossible on original hardware. This fusion of old-school aesthetics with modern technology results in a unique visual identity that stands out in a crowded market.</p>')|raw }}
                </article>

                <!-- Author Box -->
                <section class="author-box" data-aos="fade-up">
                    <div class="d-flex flex-column flex-md-row align-items-center text-center text-md-start">
                        <img src="{{ article.author.avatar|default('https://images.unsplash.com/photo-1557862921-37829c790f19?q=80&w=2071&auto=format&fit=crop') }}" 
                             class="rounded-circle me-md-4 mb-3 mb-md-0" 
                             alt="Author {{ article.author.name }}">
                        <div>
                            <h5 class="text-muted">WRITTEN BY</h5>
                            <h4 class="mb-1">{{ article.author.name|default('Alex Doe') }}</h4>
                            <p class="text-muted mb-0">{{ article.author.bio|default('Lead Tech Writer at YourBlog, passionate about the intersection of art and technology. Alex has been covering the gaming industry for over a decade.') }}</p>
                        </div>
                    </div>
                </section>

                <!-- Share Box -->
                <section class="share-box text-center" data-aos="fade-up">
                    <h4 class="mb-3">Share this Article</h4>
                    <div class="d-flex justify-content-center share-icons">
                        <a href="https://twitter.com/intent/tweet?url={{ request.uri|url_encode }}&text={{ article.title|url_encode }}" 
                           target="_blank" aria-label="Share on Twitter" class="mx-2">
                            <i class="bi bi-twitter-x"></i>
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.uri|url_encode }}" 
                           target="_blank" aria-label="Share on Facebook" class="mx-2">
                            <i class="bi bi-facebook"></i>
                        </a>
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.uri|url_encode }}" 
                           target="_blank" aria-label="Share on LinkedIn" class="mx-2">
                            <i class="bi bi-linkedin"></i>
                        </a>
                        <a href="mailto:?subject={{ article.title|url_encode }}&body={{ request.uri|url_encode }}" 
                           aria-label="Share via Email" class="mx-2">
                            <i class="bi bi-envelope"></i>
                        </a>
                    </div>
                </section>

                <!-- Related Articles -->
                {% if related_articles %}
                <section class="related-articles my-5 py-5">
                    <div class="container">
                        <div class="text-center mb-5">
                            <h2 class="display-6" data-aos="fade-up">Related Articles</h2>
                            <p class="lead" data-aos="fade-up" data-aos-delay="100">Continue reading on similar topics</p>
                        </div>
                        <div class="row">
                            {% for related in related_articles|slice(0, 3) %}
                            <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
                                <div class="card article-card">
                                    <img src="{{ related.featured_image }}" class="card-img-top" alt="{{ related.title }}">
                                    <div class="card-body">
                                        {% if related.category %}
                                            <span class="badge bg-primary mb-2">{{ related.category.name }}</span>
                                        {% endif %}
                                        <h5 class="card-title">{{ related.title }}</h5>
                                        <p class="card-text text-muted">{{ related.excerpt|slice(0, 100) }}{% if related.excerpt|length > 100 %}...{% endif %}</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">{{ related.reading_time }} min read</small>
                                            <a href="{{ related.link }}" class="btn btn-outline-primary btn-sm">Read More</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </section>
                {% endif %}

                <!-- Comments Section -->
                {% if article.comments_enabled|default(true) %}
                <section class="comments-section my-5 py-5" data-aos="fade-up">
                    <div class="container">
                        <h3 class="mb-4">Comments</h3>
                        <div id="comments-placeholder" class="bg-light p-4 rounded text-center">
                            <p class="text-muted mb-0">Comments will be loaded here</p>
                            <!-- You can integrate with Disqus, Facebook Comments, or other comment systems -->
                        </div>
                    </div>
                </section>
                {% endif %}
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block scripts %}
    <!-- AOS Script -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- Blog Theme JavaScript -->
    <script src="{{ assets_url }}/js/blog-theme.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Reading Progress Bar
            const progressBar = document.getElementById('reading-progress');
            const article = document.querySelector('.article-body');
            
            if (progressBar && article) {
                window.addEventListener('scroll', function() {
                    const articleTop = article.offsetTop - 100;
                    const articleHeight = article.offsetHeight;
                    const windowHeight = window.innerHeight;
                    const scrollTop = window.pageYOffset;
                    
                    if (scrollTop >= articleTop) {
                        const progress = Math.min(
                            ((scrollTop - articleTop) / (articleHeight - windowHeight)) * 100,
                            100
                        );
                        progressBar.style.width = Math.max(progress, 0) + '%';
                    } else {
                        progressBar.style.width = '0%';
                    }
                });
            }
            
            // Smooth scroll for table of contents links
            document.querySelectorAll('.table-of-contents a[href^="#"]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
{% endblock %}